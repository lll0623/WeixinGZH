"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e():t.Listloading=e()}(void 0,function(){function t(t){var e=Date.parse(new Date),l=(e-t)/1e3,i=parseInt(l/86400),n=parseInt(l/3600),o=parseInt(l/60),s=parseInt(l);if(i>0&&i<4)return i+"天前";if(i<=0&&n>0)return n+"小时前";if(n<=0&&o>0)return o+"分钟前";if(o<=0&&s>=0)return"刚刚之前";var r=new Date(t);return r.getFullYear()+"年"+(r.getMonth()+1)+"月"+r.getDate()+"日 "+r.getHours()+"::"+r.getMinutes()+":"+r.getSeconds()}function e(t,e){this.ele=$(t);var l=this.ele.attr("id");if(l||(l="listLoading"+Math.random().toString().replace("0.",""),this.ele.attr("id",l)),this.id=l,this.children=$(this.ele.get(0).children[0]),"object"!==(void 0===e?"undefined":_typeof(e))||!$.isFunction(e.pullDownAction)){var i=e?e.iscrollOptions||{}:{};return this.iscroll=new IScroll("#"+l,i),void document.addEventListener("touchmove",function(t){t.preventDefault()},!1)}this.pullUpId="pullUp-"+l,this.pullDownId="pullDown-"+l,this.init(e)}var l=function(){var t,e,l,i,n,o;return e={},o=this,t=function(t,l){var i,n;return i=null!=(n=e[t])?n:e[t]=[],i.push(l)},l=function(e,l){return i(e),t(e,l)},i=function(t){var l;return null!=(l=e[t])?l.length=0:void 0},n=function(){var t,l,i,n,s,r;for(r=Array.prototype.shift.call(arguments),l=null!=(s=e[r])?s:e[r]=[],i=0,n=l.length;i<n;i++){if(void 0==(t=l[i]))return!1;if(t.apply(o,arguments)===!1)return!1}},{listen:t,one:l,remove:i,trigger:n}}();return e.prototype={version:"1.1.8",init:function(t){this.options={},this.options.upLoadmoretxt='<i class="icon-up"></i>上拉加载更多',this.options.pullDrefreshtxt='<i class="icon-down"></i>下拉加载更多',this.options.loadertxt='<i class="icon-loading"></i>正在加载更多',this.options.Realtimetxt="松开刷新",this.options.loaderendtxt="已显示完全部",this.options.viewHeight=this.ele.height(),this.options.pullUpActionStr="pullUpActionStr"+this.id,this.options.pullDownActionStr="pullDownAction"+this.id,l.remove(this.options.pullUpActionStr),l.remove(this.options.pullDownActionStr),$.extend(this.options,t),this.render()},render:function(){this.pullDownAction(!0)},destroy:function(){this.children.css({"-webkit-transform":"",transform:""}),$("#"+this.pullDownId+", #"+this.pullUpId).remove(),this.iscroll.destroy()},refresh:function(t){this.createPullUpEle(t)},createPullUpEle:function(t){var e=this.options,l=this.children;l.css("min-height","auto");var i=l.height(),n=this.pullUpId,o=e.viewHeight,s=e.pullDownOffset,r=this.iscroll;if(e.minScrollHeight=o+s,this.pullUpEle)i<e.minScrollHeight&&(this.pullUpEle.remove(),this.pullUpEle=null,this.options.pullUpOffset=0,l.css("min-height",e.minScrollHeight));else if($.isFunction(e.pullUpAction)&&i>e.minScrollHeight){var u='<div id="'+n+'" data-class="pullUpId"><span class="pullUpLabel inlineblock-span">'+e.upLoadmoretxt+"</span></div>";l.append(u),this.pullUpEle=$("#"+n),e.pullUpOffset=this.pullUpEle.get(0).offsetHeight}else l.css("min-height",e.minScrollHeight);r&&(this.pullUpEle&&!t&&this.pullUpEle.height(0),r.refresh(),this.pullUpEle&&!t&&(this.pullUpEle.removeAttr("style"),r.maxScrollY=r.maxScrollY-this.options.pullUpOffset),0!==r.y||t||this.resizeAnimate())},createPullIScroll:function(){var e=this.options,l="";e.disableTime&&(e.endDate=Date.parse(new Date),l='<span class="time">最后更新时间：<em id="'+this.id+'time-em">'+t(e.endDate)+"</em></span>");var i=$('<div id="'+this.pullDownId+'" data-class="pullDownId">    <span class="pullDownLabel inlineblock-span">'+e.pullDrefreshtxt+"</span>"+l+"</div>");i.prependTo(this.children),this.pullDownEle=i,this.options.pullDownOffset=i.get(0)?i.get(0).offsetHeight:0,this.createPullUpEle()},toggleClassText:function(t,e,l,i){t.attr("class",e).find("."+l).html(i)},resizeAnimate:function(t){var e=this.iscroll,l=this.options.pullDownOffset;if(t){var i=-e.maxScrollY-l;-t<=i&&(t=-i)}else t=-l;e.scrollTo(0,t,300,IScroll.utils.ease.quadratic)},scrollEvent:function(){var e=this,l=this.options,i=this.iscroll,n=(this.pullUpId,this.pullDownEle),o=this.toggleClassText,s=l.pullDrefreshtxt,r=l.upLoadmoretxt,u=l.Realtimetxt,a=l.loadertxt,p=-l.pullDownOffset;this.ele.get(0).addEventListener("touchstart",function(t){t.returnValue=!0}),i.on("scrollStart",function(){var i=e.pullUpEle;e.startPullTime=(new Date).getTime(),l.disableTime&&$("#"+e.id+"time-em").html(t(l.endDate)),n&&n.hasClass("loading")?o(n,"","pullDownLabel",s):i&&i.hasClass("loading")&&o(i,"","pullUpLabel",r)}),i.on("scrollMove",function(){var t=this.y,l=this.maxScrollY,i=e.pullUpEle,a=n.hasClass("flip"),p=i&&i.hasClass("flip");t>5&&!a?o(n,"flip","pullDownLabel",'<i class="icon-up"></i>'+u):t<5&&a?o(n,"","pullDownLabel",s):i&&t<l-5&&!p?o(i,"flip","pullUpLabel",'<i class="icon-down"></i>'+u):i&&t>l+5&&p&&o(i,"","pullUpLabel",r)}),i.on("scrollEnd",function(){var t=this.y,i=this.maxScrollY,s=e.pullUpEle,r=new Date;if(t===i&&s&&o(s,"flip","pullUpLabel",u),e.endPullTime=r.getTime(),e.totalGapTime=e.endPullTime-e.startPullTime,e.options.endDate=Date.parse(r),e.totalGapTime<200)return void(t>p&&t<1&&e.resizeAnimate());n&&n.hasClass("flip")?(o(n,"loading","pullDownLabel",a),e.pullDownAction()):s&&s.hasClass("flip")?(o(s,"loading","pullUpLabel",a),e.pullUpAction()):t>p&&t<1?e.resizeAnimate():-i>=-t&&i+l.pullUpOffset>t&&e.resizeAnimate(i+l.pullUpOffset)})},pullDownAction:function t(e){var i=(new Date).getTime()-this.startPullTime,n=this,o=this.options,t=o.pullDownAction,s=o.pullDownActionStr;$("#"+n.id);$.isFunction(t)&&(this.iscroll||(l.listen(s,function(){n.createPullIScroll();var t={startY:-o.pullDownOffset,listLoading:!0,scrollbars:!0};$.extend(t,o.iscrollOptions),n.iscroll=new IScroll("#"+n.id,t),n.scrollEvent(),l.remove(s),document.addEventListener("touchmove",function(t){t.preventDefault()},!1)}),t(function(){l.trigger(s)},e)),i>=400&&(l.listen(s,function(){n.refresh(!0);var t=n.pullUpEle;t?t.find(".pullUpLabel").html(o.upLoadmoretxt):n.createPullUpEle(),setTimeout(function(){$("body").removeClass("iscroll"),n.resizeAnimate(),n.iscroll.refresh(),l.remove(s)},1e3)}),t(function(){$("body").addClass("iscroll"),l.trigger(s)},e)))},pullUpAction:function t(){var e=this,i=(new Date).getTime()-e.startPullTime,n=e.options,t=n.pullUpAction,o=n.pullUpActionStr,s=e.iscroll;if($.isFunction(t)){var r=s.y+n.pullUpOffset;i>=400?(l.listen(o,function(){e.refresh(!0);var t=e.pullUpEle,i=n.loaderendtxt;n.pullEnd?setTimeout(function(){$("body").removeClass("iscroll"),e.resizeAnimate(r)},1e3):($("body").removeClass("iscroll"),i=n.upLoadmoretxt,s.refresh()),t.find(".pullUpLabel").html(i),l.remove(o)}),t(function(t){$("body").addClass("iscroll"),n.pullEnd=t,l.trigger(o)})):e.resizeAnimate(r)}},evt:function(t,e,l,i){var n="ontouchstart"in window,o=n?"touchstart":"mousedown",s=n?"touchend":"mouseup",r=n?"touchmove":"mousemove",u=n?"touchleave":"mouseout",a=function(t){var e={},l=t.originalEvent;return void 0==l&&(l=t),l.changedTouches?(e.pageX=l.changedTouches[0].pageX,e.pageY=l.changedTouches[0].pageY,e.clientX=l.changedTouches[0].clientX,e.clientY=l.changedTouches[0].clientY):(e.pageX=t.pageX,e.pageY=t.pageY,e.clientX=t.clientX,e.clientY=t.clientY),e.evt=t,e},p=function(t){return{x:t.clientX,y:t.clientY}},c=function(t,e){return t&&e?Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)):0},h=function(t,e,l){l(t,a(e))},f=function(t,e,l){l(t,a(e))},d=function(t,e,l){l(t,a(e))},m=function(t,e,l){l(t,a(e))},v=this.ele;switch(void 0==i&&(i=!0),e){case"mousemove":case"touchmove":i&&v.off(r,t),v.on(r,t,function(t){m($(this),t,l)});break;case"click":case"tap":var g,D=function(t){g=p(a(t))},w=function(t,e,i){var n=a(e);Date.now();c(g,p(n))<20&&h(t,e,l)};i&&(v.off(o,t),v.off(s,t)),v.on(o,t,function(t){2!=t.button&&D(t)}),v.on(s,t,function(t){if(2!=t.button){w($(this),t)}});break;case"mousedown":case"touchstart":i&&v.off(o,t),v.on(o,t,function(t){f($(this),t,l)});break;case"mouseup":case"touchend":i&&v.off(s,t),v.on(s,t,function(t){d($(this),t,l)});break;case"mouseout":i&&v.off(u,t),v.on(u,t,function(t){w(t,l)})}}},e});